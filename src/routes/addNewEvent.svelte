<script>
  import Checkbox from "../components/Checkbox.svelte";
  import FieldFormLabel from "../components/FieldFormLabel.svelte";
  import Input from "../components/Input.svelte";
  import Select from "../components/Select.svelte";

  let address = {};
  let eventType = "";
  let fetchingAddress = true;

  const civilStateOptions = [
    "Solteiro(a)",
    "Casado(a)",
    "Divorciado(a)",
    "Viúvo(a)",
    "Separado(a)",
  ];

  const fetchAddress = () => {
    fetchingAddress = true;
    fetch(`https://viacep.com.br/ws/${address.cep}/json/`, {
      method: "GET",
    })
      .then((response) => response.json())
      .then((response) => {
        address = { ...response };
        fetchingAddress = false;
      });
  };

  const onInput = (ev) => (address[ev.target.name] = ev.target.value);
  const onCheck = (ev) => {
    if (ev.target.value === eventType) {
      eventType = "";
      return;
    }

    eventType = ev.target.id;
  };
</script>

<style>
  .title {
    font-size: 24px;
    margin-bottom: 20px;
  }
</style>

<form>
  <div class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
    <h1 class="title">Dados do Contratante</h1>
    <div class="flex flex-wrap -mx-3 mb-6">
      <Input
        id="client-name"
        md="1/2"
        label="Nome do Cliente:"
        placeholder="Augusto Jorge" />
      <Select md="1/2" label="Estado Civil:" options={civilStateOptions} />
    </div>
    {#if !fetchingAddress}
      <div class="flex flex-wrap -mx-3 mb-2">
        <Input
          id="grid-street"
          md="3/4"
          label="Residente Domiciliado (a):"
          placeholder="Albuquerque"
          value={address.logradouro} />

        <Input
          id="grid-house-number"
          md="1/4"
          label="Número:"
          placeholder="000"
          value={address.numero} />
      </div>
    {/if}
    {#if !fetchingAddress}
      <div class="flex flex-wrap -mx-3 mb-2">
        <Input
          id="grid-neighborhood"
          md="2/3"
          label="Bairro:"
          placeholder="Jardim Ibirapuera"
          value={address.bairro} />
        <Input
          id="grid-city"
          md="1/3"
          label="Cidade:"
          placeholder="São Paulo"
          value={address.localidade} />
      </div>
    {/if}
    <div class="flex flex-wrap -mx-3 mb-2">
      {#if !fetchingAddress}
        <Input
          id="grid-uf"
          md="1/3"
          label="Estado:"
          placeholder="SP"
          value={address.uf} />
      {/if}
      <Input
        id="grid-zip"
        md="1/3"
        label="CEP:"
        name="cep"
        placeholder="9090045"
        minlength="8"
        maxlength="8"
        on:blur={fetchAddress}
        value={address.cep}
        on:input={onInput} />
    </div>
  </div>
  <div class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
    <h1 class="title">Dados do Evento</h1>
    <div class="flex flex-wrap -mx-3 mb-6">
      <Input
        id="client-package-type"
        md="2/2"
        label="Tipo do pacote:"
        placeholder="Augusto Jorge" />
    </div>
    <div class="flex flex-wrap -mx-3 mb-2">
      <div class="w-full md:w-1/1 px-3 mb-6 md:mb-0">
        <label
          class="block uppercase tracking-wide text-gray-700 text-xs font-bold mb-2"
          for="grid-obs">
          Observações:
        </label>
        <textarea
          class="appearance-none block w-full bg-gray-200 text-gray-700 border border-gray-200 rounded py-3 px-4 leading-tight focus:outline-none focus:bg-white focus:border-gray-500"
          id="grid-obs"
          placeholder="Albuquerque" />
      </div>
    </div>
    <div class="flex flex-wrap -mx-3 mb-2">
      <FieldFormLabel md="1/1" label="Tipo de evento:" />
      <div class="w-full md:w-1/1 px-3 mb-6 md:mb-0">
        <Checkbox
          id="weeding"
          on:click={onCheck}
          checked={eventType === 'weeding'}
          title="Casamento" />
        <Checkbox
          id="birthday"
          on:click={onCheck}
          checked={eventType === 'birthday'}
          title="Aniversário" />
      </div>
    </div>
    {#if eventType}
      <div class="flex flex-wrap -mx-3 mb-2">
        <Input
          id="grid-name-w-b"
          md="2/3"
          label={`Nome
            ${eventType === 'weeding' ? 'dos Noivos' : 'do(a) aniversariante'}:`}
          placeholder="Ronald e Mary" />
        <Input
          id="grid-event-date"
          md="1/3"
          label="Data do evento:"
          type="date" />
      </div>
      {#if eventType === 'weeding'}
        <div class="flex flex-wrap -mx-3 mb-2">
          <Input
            id="grid-weeding-location"
            md="2/3"
            label="Local da Cerimônia Religiosa:"
            placeholder="Rua 123 - Chacara 4 - Campinas" />

          <Input
            id="grid-weeding-time"
            md="1/3"
            label="Horário da Cerimônia:"
            type="time" />
        </div>
      {/if}
      <div class="flex flex-wrap -mx-3 mb-2">
        <Input
          id="grid-event-location"
          md="1/1"
          label="Local da Recepção:"
          placeholder="Rua 123 - Chacara 4 - Campinas" />
      </div>
      <div class="flex flex-wrap -mx-3 mb-2">
        <FieldFormLabel md="1/1" label="Horário da Recepção:" />
        <Input id="grid-event-time-start" md="2/4" label="Início" type="time" />
        <Input id="grid-event-time-end" md="2/4" label="Término" type="time" />
      </div>
    {/if}
  </div>
</form>
